<!DOCTYPE html>
<html><head>
  <meta charset="UTF-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous"/>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css"/>
  <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/v2.1.1/mapbox-gl.css"/>
  <link rel="stylesheet" href="/main.css"/>
  <link rel="shortcut icon" type="image/svg" href="/ocm.svg">
  <title>Open Cluster Management</title>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4" crossorigin="anonymous"></script>
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-1PXKZXT157"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-1PXKZXT157');
  </script>
</head>
<body>
    <div class="container-fluid">
        <div class="row">




<input id="current-lang" type="hidden" value="en">

<header class="navbar navbar-expand-md navbar-dark bd-navbar">
  <nav class="navbar navbar-expand-lg navbar-dark py-3 fixed-top">
    <div class="container-fluid flex-wrap flex-md-nowrap">
      <a href="/" class="navbar-brand">
        <img src="/ocm.svg" alt="" width="30" height="24" class="align-text-top">
        Open Cluster Management
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navmenu">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navmenu">
        <ul class="navbar-nav ms-auto ">
          <li class="nav-item pe-2">
            <a href="/community" class="nav-link text-light">Community</a>
          </li>
          <li class="nav-item pe-2">
            <a href="/contribute" class="nav-link text-light">Contribute</a>
          </li>
          <li class="nav-item pe-2">
            <a href="/concepts" class="nav-link text-light">Document</a>
          </li>
          <li class="nav-item dropdown pe-2">
            
            <a class="nav-link dropdown-toggle text-light" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">English</a>
            

            <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
              
              <li><a class="dropdown-item" href="#" id="to-zh">中文</a></li>
              
            </ul>
          </li>
          <li class="nav-item pe-2">
            <a class="nav-link text-light" href="https://www.youtube.com/channel/UC7xxOh2jBM5Jfwt3fsBzOZw" target="_blank">
                <i class="bi bi-youtube"></i>
            </a>
          </li>
          <li class="nav-item pe-2">
            <a class="nav-link text-light" href="https://github.com/open-cluster-management-io" target="_blank">
              <i class="bi bi-github"></i>
            </a>
          </li>
          <li class="nav-item pe-2">
            <a class="nav-link text-light" href="https://kubernetes.slack.com/?redir=%2Farchives%2FC01GE7YSUUF" target="_blank">
              <i class="bi bi-slack"></i>
            </a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
</header>
</div>
        <div class="row subject-padding">
            <div class="col-2 col-md-3 padding-none sidebar-bgc">




<div class="sidebar-toggle sidebar-toggle-sm">
    <button type="button" id="sidebarToggle" class="btn btn-info">
        <i class="bi bi-list"></i>
    </button>
</div>
<nav id="sidebar" class="sidebar-hide-sm">
    <ul class="components">
        <li id="concepts">
            <a class="navlink" href="/concepts">Concepts</a>
            <ul class="collapse">
                <li>
                    <a class="navlink" href="/concepts/architecture">Architecture</a>
                </li>
                <li>
                    <a class="navlink" href="/concepts/managedcluster">ManagedCluster</a>
                </li>
                <li>
                    <a class="navlink" href="/concepts/manifestwork">ManifestWork</a>
                </li>
                <li>
                    <a class="navlink" href="/concepts/managedclusterset">ManagedClusterSet</a>
                </li>
                <li>
                    <a class="navlink" href="/concepts/placement">Placement</a>
                </li>
                <li>
                    <a class="navlink" href="/concepts/addon">Add-ons</a>
                </li>
            </ul>
        </li>
        <li id="getting-started">
            <a class="navlink" href="/getting-started">Getting Started</a>
            <ul class="collapse">
                <li>
                    <a class="navlink" href="/getting-started/quick-start">Quick Start</a>
                </li>
                <li>
                    <a class="navlink" href="/getting-started/core">Core Components</a>
                    <ul class="collapse">
                        <li>
                            <a class="navlink" href="/getting-started/core/cluster-manager">Cluster Manager</a>
                        </li>
                        <li>
                            <a class="navlink" href="/getting-started/core/register-cluster">Klusterlet Agent</a>
                        </li>
                    </ul>
                </li>
                <li>
                    <a class="navlink" href="/getting-started/integration">Add-ons and Integrations</a>
                    <ul class="collapse">
                        <li>
                            <a class="navlink" href="/getting-started/integration/app-lifecycle">Application lifecycle management</a>
                        </li>
                        <li>
                            <a class="navlink" href="/getting-started/integration/cluster-proxy">Cluster proxy</a>
                        </li>
                        <li>
                            <a class="navlink" href="/getting-started/integration/policy-framework">Policy framework</a>
                        </li>
                        <li>
                            <a class="navlink" href="/getting-started/integration/policy-controllers">Policy controllers</a>
                        </li>
                        <li>
                            <a class="navlink" href="/getting-started/integration/managed-serviceaccount">Managed service account</a>
                        </li>
                    </ul>
                </li>
                <li>
                    <a class="navlink" href="/getting-started/administration">Administration</a>
                    <ul class="collapse">
                        <li>
                            <a class="navlink" href="/getting-started/administration/upgrading">Upgrading</a>
                        </li>
                    </ul>
                </li>
            </ul>
        </li>
        <li id="scenarios">
            <a class="navlink" href="/scenarios">Scenarios</a>
            <ul class="collapse">
                <li>
                    <a class="navlink" href="/scenarios/deploy-kubernetes-resources">Deploy Kubernetes Resources</a>
                </li>
                <li>
                    <a class="navlink" href="/scenarios/extending-managed-clusters">Extend Managed Clusters</a>
                </li>
                <li>
                    <a class="navlink" href="/scenarios/pushing-kube-api-requests">Pushing Kube API Requests to the Managed Clusters</a>
                </li>
            </ul>
        </li>
        <li id="community">
            <a class="navlink" href="/community">Community</a>
            <ul class="collapse">
                <li>
                    <a class="navlink" href="/community/releases">Releases</a>
                </li>
                <li >
                    <a class="navlink" href="/community/roadmap">Roadmap</a>
                </li>
            </ul>
        </li>
        <li id="contribute">
            <a class="navlink" href="/contribute">Contribute</a>
        </li>
        <li id="blog">
            <a class="navlink" href="/blog">Blog</a>
        </li>
        <li style="padding-top: 10px; border-top: 2px solid #448a78;">
            <a class="navlink resource" href="https://github.com/open-cluster-management-io" target="_blank"><i class="bi bi-github"></i><span style="padding-left: 10px;">GitHub</span></a>
        </li>
        <li>
            <a class="navlink resource" href="https://kubernetes.slack.com/archives/C01GE7YSUUF" target="_blank"><i class="bi bi-slack"></i><span style="padding-left: 10px;">Slack</span></a>
        </li>
        <li>
            <a class="navlink resource" href="https://www.youtube.com/channel/UC7xxOh2jBM5Jfwt3fsBzOZw" target="_blank"><i class="bi bi-youtube"></i><span style="padding-left: 10px;">YouTube</span></a>
        </li>
        <li>
            <a class="navlink resource" href="https://groups.google.com/g/open-cluster-management" target="_blank"><i class="bi bi-envelope-fill"></i><span style="padding-left: 10px;">Mailing group</span></a>
        </li>
        <li>
            <a class="navlink resource" href="https://calendar.google.com/calendar/u/0/embed?src=openclustermanagement@gmail.com" target="_blank"><i class="bi bi-calendar-event-fill"></i><span style="padding-left: 10px;">Community meetings</span></a>
        </li>
    </ul>
</nav>
<script type="text/javascript" src="/sidebar.js"></script>
</div>
            <div class="col-10 col-md-9 padding-none">
<div id="content">
    <h1>Add-ons</h1>
    <h2 id="what-is-an-add-on">What is an add-on?</h2>
<p>Open-cluster-management has a built-in mechanism named <a href="https://github.com/open-cluster-management-io/addon-framework">addon-framework</a>
to help developers to develop an extension based on the foundation components
for the purpose of working with multiple clusters in custom cases. A typical
addon should consist of two kinds of components:</p>
<ul>
<li>
<p><strong>Addon Agent</strong>: A kubernetes controller <em>in the managed cluster</em> that manages
the managed cluster for the hub admins. A typical addon agent is expected to
be working by subscribing the prescriptions (e.g. in forms of CustomResources)
from the hub cluster and then consistently reconcile the state of the managed
cluster like an ordinary kubernetes operator does.</p>
</li>
<li>
<p><strong>Addon Manager</strong>: A kubernetes controller <em>in the hub cluster</em> that applies
manifests to the managed clusters via the <a href="./manifestwork.md">ManifestWork</a>
api. In addition to resource dispatching, the manager can optionally manage
the lifecycle of CSRs for the addon agents or even the RBAC permission bond
to the CSRs&rsquo; requesting identity.</p>
</li>
</ul>
<p>In general, if a management tool working inside the managed cluster needs to
discriminate configuration for each managed cluster, it will be helpful to model
its implementation as a working addon agent. The configurations for each agent
are supposed to be persisted in the hub cluster, so the hub admin will be able
to prescribe the agent to do its job in a declarative way. In abstraction, via
the addon we will be decoupling a multi-cluster control plane into (1) strategy
dispatching and (2) execution. The addon manager doesn&rsquo;t actually apply any
changes directly to the managed cluster, instead it just places its prescription
to a dedicated namespace allocated for the accepted managed cluster. Then the
addon agent pulls the prescriptions consistently and does the execution.</p>
<p>In addition to dispatching configurations before the agents, the addon manager
will be automatically doing some fiddly preparation before the agent bootstraps,
such as:</p>
<ul>
<li>CSR applying, approving and signing.</li>
<li>Injecting and managing client credentials used by agents to access the hub
cluster.</li>
<li>The RBAC permission for the agents both in the hub cluster or the managed
cluster.</li>
<li>Installing strategy.</li>
</ul>
<h2 id="architecture">Architecture</h2>
<p>The following architecture graph shows how the coordination between addon manager
and addon agent works.</p>
<div style="text-align: center; padding: 20px;">
   <img src="/addon-architecture.png" alt="Addon Architecture" style="margin: 0 auto; width: 80%">
</div>
<h2 id="add-on-enablement">Add-on enablement</h2>
<p>From a user&rsquo;s perspective, to install the addon to the hub cluster the hub admin
should register a globally-unique <code>ClusterManagementAddon</code> resource as a singleton
placeholder in the hub cluster. For instance, the <a href="https://github.com/open-cluster-management-io/addon-framework/tree/main/examples/helloworld">helloworld</a>
add-on can be registered to the hub cluster by creating:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#66d9ef">apiVersion</span>: addon.open-cluster-management.io/v1alpha1
<span style="color:#66d9ef">kind</span>: ClusterManagementAddOn
<span style="color:#66d9ef">metadata</span>:
  <span style="color:#66d9ef">name</span>: helloworld
<span style="color:#66d9ef">spec</span>:
  <span style="color:#66d9ef">addOnMeta</span>:
    <span style="color:#66d9ef">displayName</span>: helloworld
</code></pre></div><p>The addon manager running on the hub is taking responsibility of configuring the
installation of addon agents for each managed cluster. When a user wants to enable
the add-on for a certain managed cluster, the user should create a
<code>ManagedClusterAddon</code> resource on the cluster namespace. The name of the
<code>ManagedClusterAddon</code> should be the same name of the corresponding
<code>ClusterManagementAddon</code>. For instance, the following example enables <code>helloworld</code>
add-on in &ldquo;cluster1&rdquo;:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#66d9ef">apiVersion</span>: addon.open-cluster-management.io/v1alpha1
<span style="color:#66d9ef">kind</span>: ManagedClusterAddon
<span style="color:#66d9ef">metadata</span>:
  <span style="color:#66d9ef">name</span>: helloworld
  <span style="color:#66d9ef">namespace</span>: cluster1
<span style="color:#66d9ef">spec</span>:
  <span style="color:#66d9ef">installNamespace</span>: helloworld
</code></pre></div><p>Last but not least, a neat uninstallation of the addon is also supported by simply
deleting the corresponding <code>ClusterManagementAddon</code> resource from the hub cluster
which is the &ldquo;root&rdquo; of the whole addon. The OCM platform will automatically sanitize
the hub cluster for you after the uninstalling by removing all the components either
in the hub cluster or in the manage clusters.</p>
<h3 id="add-on-healthiness">Add-on healthiness</h3>
<p>The healthiness of the addon instances are visible when we list the addons via
kubectl:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ kubectl get managedclusteraddon -A
NAMESPACE   NAME                     AVAILABLE   DEGRADED   PROGRESSING
&lt;cluster&gt;   &lt;addon&gt;                  True                   
</code></pre></div><p>The addon agent are expected to report its healthiness periodically as long as it&rsquo;s
running. Also the versioning of the addon agent can be reflected in the resources
optionally so that we can control the upgrading the agents progressively.</p>
<h2 id="examples">Examples</h2>
<p>Here&rsquo;s a few examples of cases where we will need add-ons:</p>
<ol>
<li>A tool to collect alert events in the managed cluster, and send to the hub
cluster.</li>
<li>A network solution that uses the hub to share the network info and establish
connection among managed clusters. See <a href="https://github.com/open-cluster-management-io/cluster-proxy">cluster-proxy</a></li>
<li>A tool to spread security policies to multiple clusters.</li>
</ol>
<h2 id="add-on-framework">Add-on framework</h2>
<p><a href="https://github.com/open-cluster-management-io/addon-framework">Add-on framework</a>
provides a library for developers to develop an add-ons in open-cluster-management
more easily. Take a look at the <a href="https://github.com/open-cluster-management-io/addon-framework/tree/main/examples/helloworld">helloworld example</a>
to understand how the add-on framework can be used.</p>
<h3 id="custom-signers">Custom signers</h3>
<p>The original Kubernetes CSR api only supports three built-in signers:</p>
<ul>
<li>&ldquo;kubernetes.io/kube-apiserver-client&rdquo;</li>
<li>&ldquo;kubernetes.io/kube-apiserver-client-kubelet&rdquo;</li>
<li>&ldquo;kubernetes.io/kubelet-serving&rdquo;</li>
</ul>
<p>However in some cases, we need to sign additional custom certificates for the
addon agents which is not used for connecting any kube-apiserver. The addon
manager can be serving as a custom CSR signer controller based on the
addon-framework&rsquo;s extensibility by implementing the signing logic. Note that
after successfully signing the certificates, the framework will also keep
rotating the certificates automatically for the addon.</p>
<h3 id="hub-credential-injection">Hub credential injection</h3>
<p>The addon manager developed base on <a href="https://github.com/open-cluster-management-io/addon-framework">addon-framework</a>
will automatically persist the signed certificates as secret resource to the
managed clusters after signed by either original Kubernetes CSR controller or
custom signers. The injected secrets will be:</p>
<ul>
<li>For &ldquo;kubernetes.io/kube-apiserver-client&rdquo; signer, the name will be &ldquo;<addon name>
-hub-kubeconfig&rdquo; with properties:
<ul>
<li>&ldquo;kubeconfig&rdquo;: a kubeconfig file for accessing hub cluster with the addon&rsquo;s
identity.</li>
<li>&ldquo;tls.crt&rdquo;: the signed certificate.</li>
<li>&ldquo;tls.key&rdquo;: the private key.</li>
</ul>
</li>
<li>For custom signer, the name will be &ldquo;<addon name>-<signer name>-client-cert&rdquo;
with properties:
<ul>
<li>&ldquo;tls.crt&rdquo;: the signed certificate.</li>
<li>&ldquo;tls.key&rdquo;: the private key.</li>
</ul>
</li>
</ul>
<h3 id="auto-install-by-cluster-discovery">Auto-install by cluster discovery</h3>
<p>The addon manager can automatically install an addon to the managed clusters
upon discovering new clusters by setting the <code>InstallStrategy</code> from the
<a href="https://github.com/open-cluster-management-io/addon-framework">addon-framework</a>.
On the other hand, the admin can also manually install the addon for the
clusters by applying <code>ManagedClusterAddon</code> into their cluster namespace.</p>

</div>
<script type="text/javascript" src="/clipboard-copy.js"></script>
</div>
        </div>
        <div class="row"><nav class="ocm navbar navbar-expand-lg navbar-dark py-3">
  <div class="container-fluid flex-wrap flex-md-nowrap">
    <div class="text-light">&copy; 2021 Open Cluster Management Authors. The Linux Foundation® (TLF) has registered trademarks and uses trademarks. For a list of TLF trademarks, see <a href="https://www.linuxfoundation.org/trademark-usage/" target="_blank" style="color: #f8f9fa;">Trademark Usage</a></div>
  </div>
</nav>
<script type="text/javascript" src="/lang.js"></script>
</div>
    </div>
</body>
</html>

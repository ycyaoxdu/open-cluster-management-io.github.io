<!DOCTYPE html>
<html><head>
  <meta charset="UTF-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous"/>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css"/>
  <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/v2.1.1/mapbox-gl.css"/>
  <link rel="stylesheet" href="/main.css"/>
  <link rel="shortcut icon" type="image/svg" href="/ocm.svg">
  <title>Open Cluster Management</title>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4" crossorigin="anonymous"></script>
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-1PXKZXT157"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-1PXKZXT157');
  </script>
</head>
<body>
    <div class="container-fluid">
        <div class="row">



    


<input id="current-lang" type="hidden" value="zh">

<header class="navbar navbar-expand-md navbar-dark bd-navbar">
  <nav class="navbar navbar-expand-lg navbar-dark py-3 fixed-top">
    <div class="container-fluid flex-wrap flex-md-nowrap">
      <a href="/zh/" class="navbar-brand">
        <img src="/ocm.svg" alt="" width="30" height="24" class="align-text-top">
        Open Cluster Management
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navmenu">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navmenu">
        <ul class="navbar-nav ms-auto ">
          <li class="nav-item pe-2">
            <a href="/zh/community" class="nav-link text-light">社区</a>
          </li>
          <li class="nav-item pe-2">
            <a href="/zh/contribute" class="nav-link text-light">贡献</a>
          </li>
          <li class="nav-item pe-2">
            <a href="/zh/concepts" class="nav-link text-light">文档</a>
          </li>
          <li class="nav-item dropdown pe-2">
            
            <a class="nav-link dropdown-toggle text-light" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">中文</a>
            

            <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
              
              <li><a class="dropdown-item" href="#" id="to-en">English</a></li>
              
            </ul>
          </li>
          <li class="nav-item pe-2">
            <a class="nav-link text-light" href="https://www.youtube.com/c/OpenClusterManagement" target="_blank">
                <i class="bi bi-youtube"></i>
            </a>
          </li>
          <li class="nav-item pe-2">
            <a class="nav-link text-light" href="https://github.com/open-cluster-management-io" target="_blank">
              <i class="bi bi-github"></i>
            </a>
          </li>
          <li class="nav-item pe-2">
            <a class="nav-link text-light" href="https://kubernetes.slack.com/channels/open-cluster-mgmt" target="_blank">
              <i class="bi bi-slack"></i>
            </a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
</header>
</div>
        <div class="row subject-padding">
            <div class="col-2 col-md-3 padding-none sidebar-bgc">



    


<div class="sidebar-toggle sidebar-toggle-sm">
    <button type="button" id="sidebarToggle" class="btn btn-info">
        <i class="bi bi-list"></i>
    </button>
</div>
<nav id="sidebar" class="sidebar-hide-sm">
    <ul class="components">
        <li id="concepts">
            <a class="navlink" href="/zh/concepts">概念</a>
            <ul class="collapse">
                <li>
                    <a class="navlink" href="/zh/concepts/architecture">架构</a>
                </li>
                <li>
                    <a class="navlink" href="/zh/concepts/clusterclaim">集群声明</a>
                </li>
                <li>
                    <a class="navlink" href="/zh/concepts/managedcluster">托管集群</a>
                </li>
                <li>
                    <a class="navlink" href="/zh/concepts/manifestwork">资源下发</a>
                </li>
                <li>
                    <a class="navlink" href="/zh/concepts/managedclusterset">托管集群分组</a>
                </li>
                <li>
                    <a class="navlink" href="/zh/concepts/placement">匹配路由</a>
                </li>
                <li>
                    <a class="navlink" href="/zh/concepts/addon">自定义插件</a>
                </li>
                <li>
                    <a class="navlink" href="/zh/concepts/policy">Policy</a>
                </li>
            </ul>
        </li>
        <li id="getting-started">
            <a class="navlink" href="/zh/getting-started">安装</a>
            <ul class="collapse">
                <li>
                    <a class="navlink" href="/zh/getting-started/quick-start">快速开始</a>
                </li>
                <li>
                    <a class="navlink" href="/zh/getting-started/core">核心组件</a>
                    <ul class="collapse">
                        <li>
                            <a class="navlink" href="/zh/getting-started/core/cluster-manager">中枢控制器</a>
                        </li>
                        <li>
                            <a class="navlink" href="/zh/getting-started/core/register-cluster">集群代理控制器</a>
                        </li>
                    </ul>
                </li>
                <li>
                    <a class="navlink" href="/zh/getting-started/integration">插件和集成</a>
                    <ul class="collapse">
                        <li>
                            <a class="navlink" href="/zh/getting-started/integration/app-lifecycle">应用生命周期管理</a>
                        </li>
                        <li>
                            <a class="navlink" href="/zh/getting-started/integration/cluster-proxy">多集群网络隧道</a>
                        </li>
                        <li>
                            <a class="navlink" href="/zh/getting-started/integration/policy-framework">Policy框架</a>
                        </li>
                        <li>
                            <a class="navlink" href="/zh/getting-started/integration/policy-controllers">Policy控制器</a>
                        </li>
                        <li>
                            <a class="navlink" href="/zh/getting-started/integration/managed-serviceaccount">托管多集群ServiceAccount</a>
                        </li>
                    </ul>
                </li>
                <li>
                    <a class="navlink" href="/zh/getting-started/administration">运维管理</a>
                    <ul class="collapse">
                        <li>
                            <a class="navlink" href="/zh/getting-started/administration/upgrading">升级版本</a>
                        </li>
                    </ul>
                </li>
            </ul>
        </li>
        <li id="developer-guides">
            <a class="navlink" href="/zh/developer-guides">开发指南</a>
            <ul class="collapse">
                <li>
                    <a class="navlink" href="/zh/developer-guides/addon">Add-on 开发指南</a>
                </li>
                <li>
                    <a class="navlink" href="/zh/developer-guides/vscode-extension">VScode Extension</a>
                </li>
            </ul>
        </li>
        <li id="scenarios">
            <a class="navlink" href="/zh/scenarios">应用场景</a>
            <ul class="collapse">
                <li>
                    <a class="navlink" href="/zh/scenarios/deploy-kubernetes-resources">部署Kubernetes资源</a>
                </li>
                <li>
                    <a class="navlink" href="/zh/scenarios/distribute-workload-with-placement">通过placement分发工作负载</a>
                </li>
                <li>
                    <a class="navlink" href="/zh/scenarios/extend-multicluster-scheduling-capabilities">扩展多集群调度能力</a>
                </li>
                <li>
                    <a class="navlink" href="/zh/scenarios/extending-managed-clusters">扩展集群模型</a>
                </li>
                <li>
                    <a class="navlink" href="/zh/scenarios/integration-with-argocd">集成Argo CD</a>
                </li>                
                <li>
                    <a class="navlink" href="/zh/scenarios/pushing-kube-api-requests">向托管集群推送Kube API请求</a>
                </li>
            </ul>
        </li>
        <li id="community">
            <a class="navlink" href="/zh/community">社区</a>
            <ul class="collapse">
                <li>
                    <a class="navlink" href="/zh/community/releases">发行版本</a>
                </li>
                <li >
                    <a class="navlink" href="/zh/community/roadmap">社区规划</a>
                </li>
            </ul>
        </li>
        <li id="contribute">
            <a class="navlink" href="/zh/contribute">贡献</a>
        </li>
        <li id="blog">
            <a class="navlink" href="/zh/blog">博客</a>
        </li>
        <li style="padding-top: 10px; border-top: 2px solid #448a78;">
            <a class="navlink resource" href="https://github.com/open-cluster-management-io" target="_blank"><i class="bi bi-github"></i><span style="padding-left: 10px;">GitHub</span></a>
        </li>
        <li>
            <a class="navlink resource" href="https://kubernetes.slack.com/channels/open-cluster-mgmt" target="_blank"><i class="bi bi-slack"></i><span style="padding-left: 10px;">Slack</span></a>
        </li>
        <li>
            <a class="navlink resource" href="https://www.youtube.com/c/OpenClusterManagement" target="_blank"><i class="bi bi-youtube"></i><span style="padding-left: 10px;">YouTube</span></a>
        </li>
        <li>
            <a class="navlink resource" href="https://groups.google.com/g/open-cluster-management" target="_blank"><i class="bi bi-envelope-fill"></i><span style="padding-left: 10px;">Mailing group</span></a>
        </li>
        <li>
            <a class="navlink resource" href="https://calendar.google.com/calendar/u/0/embed?src=openclustermanagement@gmail.com" target="_blank"><i class="bi bi-calendar-event-fill"></i><span style="padding-left: 10px;">Community meetings</span></a>
        </li>
    </ul>
</nav>
<script type="text/javascript" src="/sidebar.js"></script>
</div>
            <div class="col-10 col-md-9 padding-none">
<div id="content">
    <h1>Policy framework</h1>
    <p>The policy framework provides governance capabilities to OCM managed Kubernetes clusters. Policies
provide visibility and drive remediation for various security and configuration aspects to help IT
administrators meet their requirements.</p>
<!-- spellchecker-disable -->



  <div class="gdoc-toc gdoc-toc__level--6"><nav id="TableOfContents"><ul>
        <li><a href="#api-concepts">API Concepts</a></li>
        <li><a href="#architecture">Architecture</a></li>
        <li><a href="#prerequisite">Prerequisite</a></li>
        <li><a href="#install-the-governance-policy-framework-hub-components">Install the governance-policy-framework hub components</a>
          <ul>
            <li><a href="#install-via-clusteradm-cli">Install via Clusteradm CLI</a></li>
            <li><a href="#install-from-source">Install from source</a></li>
          </ul>
        </li>
        <li><a href="#deploy-the-synchronization-components-to-the-managed-clusters">Deploy the synchronization components to the managed cluster(s)</a>
          <ul>
            <li><a href="#deploy-via-clusteradm-cli">Deploy via Clusteradm CLI</a></li>
            <li><a href="#deploy-from-source">Deploy from source</a></li>
          </ul>
        </li>
        <li><a href="#what-is-next">What is next</a></li>
      </ul></nav><hr></div>


<!-- spellchecker-enable -->
<h2 id="api-concepts">API Concepts</h2>
<p>View the <a href="/concepts/policy">Policy API</a> page for additional details about the Policy API managed by
the Policy Framework components, including:</p>
<ul>
<li><a href="/concepts/policy#policy"><code>Policy</code></a></li>
<li><a href="/concepts/policy#policyset"><code>PolicySet</code></a></li>
<li><a href="/concepts/policy#placementbinding"><code>PlacementBinding</code></a></li>
</ul>
<h2 id="architecture">Architecture</h2>
<div style="text-align: center; padding: 20px;">
   <img src="/policy-framework-architecture-diagram.jpg" alt="Policy framework architecture" style="margin: 0 auto; width: 80%">
</div>
<p>The governance policy framework distributes policies to managed clusters and collects results to
send back to the hub cluster.</p>
<ul>
<li><a href="https://github.com/open-cluster-management-io/governance-policy-propagator">Policy propagator</a></li>
<li><a href="https://github.com/open-cluster-management-io/governance-policy-framework-addon">Policy framework addon</a></li>
</ul>
<p>Note that in OCM versions newer than 0.8.x, the following controllers were consolidated into the
<a href="https://github.com/open-cluster-management-io/governance-policy-framework-addon">policy framework addon</a>.</p>
<ul>
<li><a href="https://github.com/open-cluster-management-io/governance-policy-spec-sync">Policy spec sync</a></li>
<li><a href="https://github.com/open-cluster-management-io/governance-policy-status-sync">Policy status sync</a></li>
<li><a href="https://github.com/open-cluster-management-io/governance-policy-template-sync">Policy template sync</a></li>
</ul>
<h2 id="prerequisite">Prerequisite</h2>
<p>You must meet the following prerequisites to install the policy framework:</p>
<ul>
<li>
<p>Ensure <a href="https://kubernetes.io/docs/tasks/tools/install-kubectl"><code>kubectl</code></a> and
<a href="https://kubectl.docs.kubernetes.io/installation/kustomize/"><code>kustomize</code></a> are installed.</p>
</li>
<li>
<p>Ensure <a href="https://golang.org/doc/install">Golang</a> is installed, if you are planning to install from
the source.</p>
</li>
<li>
<p>Ensure the <code>open-cluster-management</code> <em>cluster manager</em> is installed. See
<a href="/getting-started/core/cluster-manager">Cluster Manager</a> for more information.</p>
</li>
<li>
<p>Ensure the <code>open-cluster-management</code> <em>klusterlet</em> is installed. See
<a href="/getting-started/core/register-cluster">Klusterlet</a> for more information.</p>
</li>
<li>
<p>If you are using <code>PlacementRules</code> with your policies, ensure the <code>open-cluster-management</code>
<em>application</em> is installed . See
<a href="/getting-started/integration/app-lifecycle">Application management</a> for more information. If you
are using the default <code>Placement</code> API, you can skip the Application management installation, but
you do need to install the <code>PlacementRule</code> CRD with this command:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Shell" data-lang="Shell">kubectl apply -f https://raw.githubusercontent.com/open-cluster-management-io/multicloud-operators-subscription/main/deploy/hub-common/apps.open-cluster-management.io_placementrules_crd.yaml
</code></pre></div></li>
</ul>
<h2 id="install-the-governance-policy-framework-hub-components">Install the governance-policy-framework hub components</h2>
<h3 id="install-via-clusteradm-cli">Install via Clusteradm CLI</h3>
<p>Ensure <code>clusteradm</code> CLI is installed and is at least v0.3.0. Download and extract the
<a href="https://github.com/open-cluster-management-io/clusteradm/releases/latest">clusteradm binary</a>. For
more details see the
<a href="https://github.com/open-cluster-management-io/clusteradm/blob/main/README.md#quick-start">clusteradm GitHub page</a>.</p>
<ol>
<li>
<p>Deploy the policy framework controllers to the hub cluster:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Shell" data-lang="Shell"><span style="color:#75715e"># The context name of the clusters in your kubeconfig</span>
<span style="color:#75715e"># If the clusters are created by KinD, then the context name will the follow the pattern &#34;kind-&lt;cluster name&gt;&#34;.</span>
export CTX_HUB_CLUSTER<span style="color:#f92672">=</span>&lt;your hub cluster context&gt;           <span style="color:#75715e"># export CTX_HUB_CLUSTER=kind-hub</span>
export CTX_MANAGED_CLUSTER<span style="color:#f92672">=</span>&lt;your managed cluster context&gt;   <span style="color:#75715e"># export CTX_MANAGED_CLUSTER=kind-cluster1</span>

<span style="color:#75715e"># Set the deployment namespace</span>
export HUB_NAMESPACE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;open-cluster-management&#34;</span>

<span style="color:#75715e"># Deploy the policy framework hub controllers</span>
clusteradm install hub-addon --names governance-policy-framework --context <span style="color:#e6db74">${</span>CTX_HUB_CLUSTER<span style="color:#e6db74">}</span>
</code></pre></div></li>
<li>
<p>Ensure the pods are running on the hub with the following command:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Shell" data-lang="Shell">$ kubectl get pods -n <span style="color:#e6db74">${</span>HUB_NAMESPACE<span style="color:#e6db74">}</span>
NAME                                                       READY   STATUS    RESTARTS   AGE
governance-policy-addon-controller-bc78cbcb4-529c2         1/1     Running   <span style="color:#ae81ff">0</span>          94s
governance-policy-propagator-8c77f7f5f-kthvh               1/1     Running   <span style="color:#ae81ff">0</span>          94s
</code></pre></div><ul>
<li>See more about the governance-policy-framework components:
<ul>
<li><a href="https://github.com/open-cluster-management-io/governance-policy-propagator">policy-propagator</a></li>
<li><a href="https://github.com/open-cluster-management-io/governance-policy-addon-controller">policy-addon-controller</a></li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 id="install-from-source">Install from source</h3>
<ol>
<li>
<p>Deploy the policy Custom Resource Definitions (CRD) and policy propagator component to the
<code>open-cluster-management</code> namespace on the hub cluster with the following commands:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Shell" data-lang="Shell"><span style="color:#75715e"># Configure kubectl to point to the hub cluster</span>
kubectl config use-context <span style="color:#e6db74">${</span>CTX_HUB_CLUSTER<span style="color:#e6db74">}</span>

<span style="color:#75715e"># Create the namespace</span>
export HUB_NAMESPACE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;open-cluster-management&#34;</span>
kubectl create ns <span style="color:#e6db74">${</span>HUB_NAMESPACE<span style="color:#e6db74">}</span>

<span style="color:#75715e"># Set the hub cluster name</span>
export HUB_CLUSTER_NAME<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;hub&#34;</span>

<span style="color:#75715e"># Set the hub kubeconfig file</span>
export HUB_KUBECONFIG<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;hub-kubeconfig&#34;</span>

<span style="color:#75715e"># Apply the CRDs</span>
export GIT_PATH<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://raw.githubusercontent.com/open-cluster-management-io/governance-policy-propagator/v0.9.0/deploy&#34;</span>
kubectl apply -f <span style="color:#e6db74">${</span>GIT_PATH<span style="color:#e6db74">}</span>/crds/policy.open-cluster-management.io_policies.yaml
kubectl apply -f <span style="color:#e6db74">${</span>GIT_PATH<span style="color:#e6db74">}</span>/crds/policy.open-cluster-management.io_placementbindings.yaml
kubectl apply -f <span style="color:#e6db74">${</span>GIT_PATH<span style="color:#e6db74">}</span>/crds/policy.open-cluster-management.io_policyautomations.yaml
kubectl apply -f <span style="color:#e6db74">${</span>GIT_PATH<span style="color:#e6db74">}</span>/crds/policy.open-cluster-management.io_policysets.yaml

<span style="color:#75715e"># Deploy the policy-propagator</span>
kubectl apply -f <span style="color:#e6db74">${</span>GIT_PATH<span style="color:#e6db74">}</span>/operator.yaml -n <span style="color:#e6db74">${</span>HUB_NAMESPACE<span style="color:#e6db74">}</span>
</code></pre></div></li>
<li>
<p>Ensure the pods are running on the hub with the following command:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Shell" data-lang="Shell">$ kubectl get pods -n <span style="color:#e6db74">${</span>HUB_NAMESPACE<span style="color:#e6db74">}</span>
NAME                                                       READY   STATUS    RESTARTS   AGE
governance-policy-propagator-8c77f7f5f-kthvh               1/1     Running   <span style="color:#ae81ff">0</span>          94s
</code></pre></div><ul>
<li>See more about the governance-policy-framework components:
<ul>
<li><a href="https://github.com/open-cluster-management-io/governance-policy-propagator">policy-propagator</a></li>
<li><a href="https://github.com/open-cluster-management-io/governance-policy-addon-controller">policy-addon-controller</a></li>
</ul>
</li>
</ul>
</li>
</ol>
<h2 id="deploy-the-synchronization-components-to-the-managed-clusters">Deploy the synchronization components to the managed cluster(s)</h2>
<h3 id="deploy-via-clusteradm-cli">Deploy via Clusteradm CLI</h3>
<ol>
<li>
<p>To deploy the synchronization components to a self-managed hub cluster:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Shell" data-lang="Shell">clusteradm addon enable --names governance-policy-framework --clusters &lt;managed_hub_cluster_name&gt; --annotate addon.open-cluster-management.io/on-multicluster-hub<span style="color:#f92672">=</span>true --context <span style="color:#e6db74">${</span>CTX_HUB_CLUSTER<span style="color:#e6db74">}</span>
</code></pre></div><p>To deploy the synchronization components to a managed cluster:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Shell" data-lang="Shell">clusteradm addon enable --names governance-policy-framework --clusters &lt;cluster_name&gt; --context <span style="color:#e6db74">${</span>CTX_HUB_CLUSTER<span style="color:#e6db74">}</span>
</code></pre></div></li>
<li>
<p>Verify that the
<a href="https://github.com/open-cluster-management-io/governance-policy-framework-addon">governance-policy-framework-addon controller</a>
pod is running on the managed cluster with the following command:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Shell" data-lang="Shell">$ kubectl get pods -n open-cluster-management-agent-addon
NAME                                                     READY   STATUS    RESTARTS   AGE
governance-policy-framework-addon-57579b7c-652zj         1/1     Running   <span style="color:#ae81ff">0</span>          87s
</code></pre></div><p><strong>NOTE</strong>: If you are using clusteradm v0.3.x or older, the pod will be called <code>governance-policy-framework</code> and
have a container per synchronization component (2 on a self-managed Hub, or 3 on a managed cluster).</p>
</li>
</ol>
<h3 id="deploy-from-source">Deploy from source</h3>
<ol>
<li>
<p>Export the hub cluster <code>kubeconfig</code> with the following command:</p>
<p>For <code>kind</code> cluster:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Shell" data-lang="Shell">kind get kubeconfig --name <span style="color:#e6db74">${</span>HUB_CLUSTER_NAME<span style="color:#e6db74">}</span> --internal &gt; <span style="color:#e6db74">${</span>HUB_KUBECONFIG<span style="color:#e6db74">}</span>
</code></pre></div><p>For non-<code>kind</code> clusters:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Shell" data-lang="Shell">kubectl config view --context<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>CTX_HUB_CLUSTER<span style="color:#e6db74">}</span> --minify --flatten &gt; <span style="color:#e6db74">${</span>HUB_KUBECONFIG<span style="color:#e6db74">}</span>
</code></pre></div></li>
<li>
<p>Deploy the
<a href="https://github.com/open-cluster-management-io/governance-policy-framework-addon">policy synchronization component</a>
to each managed cluster. Run the following commands:</p>
<p><strong>NOTE</strong>: The <code>--disable-spec-sync</code> flag should be set to <code>true</code> in the <code>governance-policy-framework-addon</code> container
arguments when deploying the synchronization component to a hub that is managing itself.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Shell" data-lang="Shell"><span style="color:#75715e"># Set whether or not this is being deployed on the Hub</span>
export DEPLOY_ON_HUB<span style="color:#f92672">=</span>false

<span style="color:#75715e"># Configure kubectl to point to the managed cluster</span>
kubectl config use-context <span style="color:#e6db74">${</span>CTX_MANAGED_CLUSTER<span style="color:#e6db74">}</span>

<span style="color:#75715e"># Create the namespace for the synchronization components</span>
export MANAGED_NAMESPACE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;open-cluster-management-agent-addon&#34;</span>
kubectl create ns <span style="color:#e6db74">${</span>MANAGED_NAMESPACE<span style="color:#e6db74">}</span>

<span style="color:#75715e"># Create the secret to authenticate with the hub</span>
kubectl -n <span style="color:#e6db74">${</span>MANAGED_NAMESPACE<span style="color:#e6db74">}</span> create secret generic hub-kubeconfig --from-file<span style="color:#f92672">=</span>kubeconfig<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>HUB_KUBECONFIG<span style="color:#e6db74">}</span>

<span style="color:#75715e"># Apply the policy CRD</span>
export GIT_PATH<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://raw.githubusercontent.com/open-cluster-management-io&#34;</span>
kubectl apply -f <span style="color:#e6db74">${</span>GIT_PATH<span style="color:#e6db74">}</span>/governance-policy-propagator/v0.9.0/deploy/crds/policy.open-cluster-management.io_policies.yaml

<span style="color:#75715e"># Set the managed cluster name and create the namespace</span>
export MANAGED_CLUSTER_NAME<span style="color:#f92672">=</span>&lt;your managed cluster name&gt;  <span style="color:#75715e"># export MANAGED_CLUSTER_NAME=cluster1</span>
kubectl create ns <span style="color:#e6db74">${</span>MANAGED_CLUSTER_NAME<span style="color:#e6db74">}</span>

<span style="color:#75715e"># Deploy the synchronization component</span>
export COMPONENT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;governance-policy-framework-addon&#34;</span>
kubectl apply -f <span style="color:#e6db74">${</span>GIT_PATH<span style="color:#e6db74">}</span>/<span style="color:#e6db74">${</span>COMPONENT<span style="color:#e6db74">}</span>/v0.9.0/deploy/operator.yaml -n <span style="color:#e6db74">${</span>MANAGED_NAMESPACE<span style="color:#e6db74">}</span>
kubectl patch deployment governance-policy-framework-addon -n <span style="color:#e6db74">${</span>MANAGED_NAMESPACE<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  -p <span style="color:#e6db74">&#34;{\&#34;spec\&#34;:{\&#34;template\&#34;:{\&#34;spec\&#34;:{\&#34;containers\&#34;:[{\&#34;name\&#34;:\&#34;governance-policy-framework-addon\&#34;,\&#34;args\&#34;:[\&#34;--hub-cluster-configfile=/var/run/klusterlet/kubeconfig\&#34;, \&#34;--cluster-namespace=</span><span style="color:#e6db74">${</span>MANAGED_CLUSTER_NAME<span style="color:#e6db74">}</span><span style="color:#e6db74">\&#34;, \&#34;--enable-lease=true\&#34;, \&#34;--log-level=2\&#34;, \&#34;--disable-spec-sync=</span><span style="color:#e6db74">${</span>DEPLOY_ON_HUB<span style="color:#e6db74">}</span><span style="color:#e6db74">\&#34;]}]}}}}&#34;</span>
</code></pre></div></li>
<li>
<p>Verify that the pods are running on the managed cluster with the following command:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Shell" data-lang="Shell">$ kubectl get pods -n <span style="color:#e6db74">${</span>MANAGED_NAMESPACE<span style="color:#e6db74">}</span>
NAME                                                READY   STATUS    RESTARTS   AGE
governance-policy-framework-addon-6474b6d898-tmkw6  1/1     Running   <span style="color:#ae81ff">0</span>          2m14s
</code></pre></div></li>
</ol>
<h2 id="what-is-next">What is next</h2>
<p>Install the <a href="../policy-controllers">policy controllers</a> to the managed clusters.</p>

</div>
<script type="text/javascript" src="/clipboard-copy.js"></script>
</div>
        </div>
        <div class="row"><nav class="ocm navbar navbar-expand-lg navbar-dark py-3">
  <div class="container-fluid flex-wrap flex-md-nowrap">
    <div class="text-light">&copy; 2021 Open Cluster Management Authors. The Linux Foundation® (TLF) has registered trademarks and uses trademarks. For a list of TLF trademarks, see <a href="https://www.linuxfoundation.org/trademark-usage/" target="_blank" style="color: #f8f9fa;">Trademark Usage</a></div>
  </div>
</nav>
<script type="text/javascript" src="/lang.js"></script>
</div>
    </div>
</body>
</html>
